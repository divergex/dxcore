cmake_minimum_required(VERSION 3.10)
project(dxcore)

set(CMAKE_CXX_STANDARD 23)
set(CMAKE_CXX_STANDARD_REQUIRED True)

find_package(OpenMP REQUIRED)
if (OpenMP_CXX_FOUND)
    message(STATUS "Found OpenMP")
    set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} ${OpenMP_CXX_FLAGS}")
endif()
find_package(Eigen3 REQUIRED)

add_library(dxcore SHARED
        src/lib/portfolio_optimization.cpp
        src/lib/portfolio_optimization.h
        src/wrapper.h)

target_link_libraries(dxcore PRIVATE OpenMP::OpenMP_CXX)
target_link_libraries(dxcore PRIVATE Eigen3::Eigen)

set_target_properties(dxcore PROPERTIES
        LIBRARY_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib
        RUNTIME_OUTPUT_DIRECTORY ${CMAKE_BINARY_DIR}/lib
)

target_include_directories(dxcore PUBLIC .)


add_executable(dxcore_test
        test/test_portfolio_optimization.cpp
)

target_link_libraries(dxcore_test PRIVATE dxcore)

enable_testing()

find_package(GTest CONFIG REQUIRED)
target_link_libraries(dxcore_test PRIVATE GTest::gtest GTest::gtest_main GTest::gmock GTest::gmock_main)

add_test(NAME dxcore_test COMMAND dxcore_test)